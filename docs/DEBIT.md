# Операция DEBIT (Списание средств)

Операция DEBIT предназначена для списания средств с баланса пользователя.

## Логика работы

1. Проверяется наличие обязательных параметров: `user_id`, `amount`, `operation_id`.
2. Сумма списания (`amount`) должна быть положительной.
3. Проверяется, не была ли уже выполнена операция с данным `operation_id` (идемпотентность).
4. Осуществляется поиск пользователя с блокировкой строки (или создаётся новый).
5. Проверяется, достаточно ли средств на балансе пользователя.
6. Если средств достаточно, баланс пользователя уменьшается на сумму списания.
7. Создаётся запись в таблице транзакций с типом `debit` и статусом `confirmed`.
8. Все действия выполняются в рамках транзакции БД.
9. В случае успеха отправляется событие `funds_debited` в очередь.
10. В случае ошибок (недостаточно средств, пользователь не найден, дублирование операции) возвращается соответствующий статус.

## Возможные статусы результата
- `success` — операция успешно выполнена
- `duplicate` — операция с таким `operation_id` уже была проведена
- `error` — ошибка (например, недостаточно средств, пользователь не найден) 
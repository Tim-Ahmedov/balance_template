# Операция TRANSFER (Перевод средств)

Операция TRANSFER предназначена для перевода средств между двумя пользователями.

## Логика работы

1. Проверяется наличие обязательных параметров: `user_id` (отправитель), `related_user_id` (получатель), `amount`, `operation_id`.
2. Сумма перевода (`amount`) должна быть положительной.
3. Отправитель и получатель не могут совпадать.
4. Проверяется, не была ли уже выполнена операция с данным `operation_id` (идемпотентность).
5. Осуществляется поиск обоих пользователей с блокировкой строк (или создаются новые).
6. Проверяется, достаточно ли средств у отправителя.
7. Баланс отправителя уменьшается, баланс получателя увеличивается на сумму перевода.
8. Создаётся запись в таблице транзакций с типом `transfer` и статусом `confirmed`.
9. Все действия выполняются в рамках транзакции БД.
10. В случае успеха отправляется событие `funds_transferred` в очередь.
11. В случае ошибок (недостаточно средств, пользователь не найден, дублирование операции) возвращается соответствующий статус.

## Возможные статусы результата
- `success` — операция успешно выполнена
- `duplicate` — операция с таким `operation_id` уже была проведена
- `error` — ошибка (например, недостаточно средств, пользователь не найден) 
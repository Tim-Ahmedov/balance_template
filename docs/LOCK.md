# Операция LOCK (Блокировка средств)

Операция LOCK предназначена для временной блокировки средств на балансе пользователя (например, для резервации под будущую операцию).

## Логика работы

1. Проверяется наличие обязательных параметров: `user_id`, `amount`, `operation_id`.
2. Сумма блокировки (`amount`) должна быть положительной.
3. Проверяется, не была ли уже выполнена операция с данным `operation_id` или `lock_id` (идемпотентность).
4. Осуществляется поиск пользователя с блокировкой строки (или создаётся новый).
5. Проверяется, достаточно ли средств на балансе пользователя.
6. Баланс пользователя уменьшается на сумму блокировки.
7. Создаётся запись в таблице заблокированных средств (`LockedFunds`) со статусом `locked`.
8. Создаётся запись в таблице транзакций с типом `lock` и статусом `confirmed`.
9. Все действия выполняются в рамках транзакции БД.
10. В случае успеха отправляется событие `funds_locked` в очередь.
11. В случае ошибок (недостаточно средств, пользователь не найден, дублирование операции) возвращается соответствующий статус.

## Возможные статусы результата
- `success` — операция успешно выполнена
- `duplicate` — операция с таким `operation_id` или `lock_id` уже была проведена
- `error` — ошибка (например, недостаточно средств, пользователь не найден) 
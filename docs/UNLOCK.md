# Операция UNLOCK (Разблокировка/Списание заблокированных средств)

Операция UNLOCK предназначена для разблокировки ранее заблокированных средств или их окончательного списания.

## Логика работы

1. Проверяется наличие обязательных параметров: `user_id`, `amount`, `operation_id`, `lock_id`.
2. Сумма (`amount`) должна быть положительной.
3. Проверяется, не была ли уже выполнена операция с данным `operation_id` (идемпотентность).
4. Осуществляется поиск записи о заблокированных средствах (`LockedFunds`) по `lock_id` и статусу `locked`.
5. Если передан параметр `confirm=true`, средства считаются окончательно списанными (`status = charged`).
6. Если `confirm` не передан или равен `false`, средства возвращаются на баланс пользователя (`status = unlocked`).
7. Обновляется статус записи о заблокированных средствах.
8. Создаётся запись в таблице транзакций с типом `unlock` и статусом `confirmed`.
9. Все действия выполняются в рамках транзакции БД.
10. В случае успеха отправляется событие `funds_unlocked` в очередь.
11. В случае ошибок (запись не найдена, пользователь не найден, дублирование операции) возвращается соответствующий статус.

## Возможные статусы результата
- `success` — операция успешно выполнена
- `duplicate` — операция с таким `operation_id` уже была проведена
- `error` — ошибка (например, запись не найдена, пользователь не найден) 